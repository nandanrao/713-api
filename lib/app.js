'use strict';

require('dotenv').config();

var express = require('express');
var bodyParser = require('body-parser');
var tokenMiddleware = require('./token');
var firebase = require('./firebase');

var mood = require('./mood');
var app = express();
app.use(bodyParser.urlencoded({ extended: false }));
app.use(bodyParser.json());

app.use(tokenMiddleware());

app.post('/mood', function (req, res, next) {
  mood.handler(req.body, req.user.id).then(function (ans) {
    res.status(201).json({ foo: 'bar' });
  });
});

app.get('/partyinfo', function (req, res, next) {
  firebase.child('time').once('value', function (snap) {
    var time = snap.val();
    var info = {
      startTime: time,
      location: 'Kongens Have'
    };
    res.json(info);
    next();
  });
});

app.get('/makemealist', function (req, res, next) {
  mood.addPublicList(req.user, req.token);
  res.sendStatus(200);
});

app.use(function (err, req, res, next) {
  console.log('err', err.statusCode || err);
  res.status(err.statusCode || err).send();
});

app.listen(process.env.PORT || 9000);

module.exports = app;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9hcHAuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxRQUFRLFFBQVIsRUFBa0IsTUFBbEI7O0FBRUEsSUFBSSxVQUFVLFFBQVEsU0FBUixDQUFkO0FBQ0EsSUFBSSxhQUFhLFFBQVEsYUFBUixDQUFqQjtBQUNBLElBQUksa0JBQWtCLFFBQVEsU0FBUixDQUF0QjtBQUNBLElBQUksV0FBVyxRQUFRLFlBQVIsQ0FBZjs7QUFFQSxJQUFJLE9BQU8sUUFBUSxRQUFSLENBQVg7QUFDQSxJQUFJLE1BQU0sU0FBVjtBQUNBLElBQUksR0FBSixDQUFRLFdBQVcsVUFBWCxDQUFzQixFQUFFLFVBQVUsS0FBWixFQUF0QixDQUFSO0FBQ0EsSUFBSSxHQUFKLENBQVEsV0FBVyxJQUFYLEVBQVI7O0FBRUEsSUFBSSxHQUFKLENBQVEsaUJBQVI7O0FBRUEsSUFBSSxJQUFKLENBQVMsT0FBVCxFQUFrQixVQUFDLEdBQUQsRUFBTSxHQUFOLEVBQVcsSUFBWCxFQUFvQjtBQUNwQyxPQUFLLE9BQUwsQ0FBYSxJQUFJLElBQWpCLEVBQXVCLElBQUksSUFBSixDQUFTLEVBQWhDLEVBQ0csSUFESCxDQUNRLGVBQU87QUFDWCxRQUFJLE1BQUosQ0FBVyxHQUFYLEVBQWdCLElBQWhCLENBQXFCLEVBQUUsS0FBSyxLQUFQLEVBQXJCO0FBQ0QsR0FISDtBQUlELENBTEQ7O0FBT0EsSUFBSSxHQUFKLENBQVEsWUFBUixFQUFzQixVQUFDLEdBQUQsRUFBTSxHQUFOLEVBQVcsSUFBWCxFQUFvQjtBQUN4QyxXQUFTLEtBQVQsQ0FBZSxNQUFmLEVBQXVCLElBQXZCLENBQTRCLE9BQTVCLEVBQXFDLGdCQUFRO0FBQzNDLFFBQUksT0FBTyxLQUFLLEdBQUwsRUFBWDtBQUNBLFFBQUksT0FBTztBQUNULGlCQUFXLElBREY7QUFFVCxnQkFBVTtBQUZELEtBQVg7QUFJQSxRQUFJLElBQUosQ0FBUyxJQUFUO0FBQ0E7QUFDRCxHQVJEO0FBU0QsQ0FWRDs7QUFZQSxJQUFJLEdBQUosQ0FBUSxjQUFSLEVBQXdCLFVBQUMsR0FBRCxFQUFNLEdBQU4sRUFBVyxJQUFYLEVBQW9CO0FBQzFDLE9BQUssYUFBTCxDQUFtQixJQUFJLElBQXZCLEVBQTZCLElBQUksS0FBakM7QUFDQSxNQUFJLFVBQUosQ0FBZSxHQUFmO0FBQ0QsQ0FIRDs7QUFLQSxJQUFJLEdBQUosQ0FBUSxVQUFDLEdBQUQsRUFBTSxHQUFOLEVBQVcsR0FBWCxFQUFnQixJQUFoQixFQUF5QjtBQUMvQixVQUFRLEdBQVIsQ0FBWSxLQUFaLEVBQW1CLElBQUksVUFBSixJQUFrQixHQUFyQztBQUNBLE1BQUksTUFBSixDQUFXLElBQUksVUFBSixJQUFrQixHQUE3QixFQUFrQyxJQUFsQztBQUNELENBSEQ7O0FBS0EsSUFBSSxNQUFKLENBQVcsUUFBUSxHQUFSLENBQVksSUFBWixJQUFvQixJQUEvQjs7QUFHQSxPQUFPLE9BQVAsR0FBaUIsR0FBakIiLCJmaWxlIjoiYXBwLmpzIiwic291cmNlc0NvbnRlbnQiOlsicmVxdWlyZSgnZG90ZW52JykuY29uZmlnKCk7XG5cbnZhciBleHByZXNzID0gcmVxdWlyZSgnZXhwcmVzcycpO1xudmFyIGJvZHlQYXJzZXIgPSByZXF1aXJlKCdib2R5LXBhcnNlcicpO1xudmFyIHRva2VuTWlkZGxld2FyZSA9IHJlcXVpcmUoJy4vdG9rZW4nKTtcbnZhciBmaXJlYmFzZSA9IHJlcXVpcmUoJy4vZmlyZWJhc2UnKTtcblxudmFyIG1vb2QgPSByZXF1aXJlKCcuL21vb2QnKTtcbnZhciBhcHAgPSBleHByZXNzKCk7XG5hcHAudXNlKGJvZHlQYXJzZXIudXJsZW5jb2RlZCh7IGV4dGVuZGVkOiBmYWxzZSB9KSk7XG5hcHAudXNlKGJvZHlQYXJzZXIuanNvbigpKTtcblxuYXBwLnVzZSh0b2tlbk1pZGRsZXdhcmUoKSk7XG5cbmFwcC5wb3N0KCcvbW9vZCcsIChyZXEsIHJlcywgbmV4dCkgPT4ge1xuICBtb29kLmhhbmRsZXIocmVxLmJvZHksIHJlcS51c2VyLmlkKVxuICAgIC50aGVuKGFucyA9PiB7XG4gICAgICByZXMuc3RhdHVzKDIwMSkuanNvbih7IGZvbzogJ2JhcicgfSk7XG4gICAgfSlcbn0pXG5cbmFwcC5nZXQoJy9wYXJ0eWluZm8nLCAocmVxLCByZXMsIG5leHQpID0+IHtcbiAgZmlyZWJhc2UuY2hpbGQoJ3RpbWUnKS5vbmNlKCd2YWx1ZScsIHNuYXAgPT4ge1xuICAgIHZhciB0aW1lID0gc25hcC52YWwoKTtcbiAgICB2YXIgaW5mbyA9IHtcbiAgICAgIHN0YXJ0VGltZTogdGltZSxcbiAgICAgIGxvY2F0aW9uOiAnS29uZ2VucyBIYXZlJ1xuICAgIH07XG4gICAgcmVzLmpzb24oaW5mbyk7XG4gICAgbmV4dCgpO1xuICB9KTtcbn0pO1xuXG5hcHAuZ2V0KCcvbWFrZW1lYWxpc3QnLCAocmVxLCByZXMsIG5leHQpID0+IHtcbiAgbW9vZC5hZGRQdWJsaWNMaXN0KHJlcS51c2VyLCByZXEudG9rZW4pXG4gIHJlcy5zZW5kU3RhdHVzKDIwMClcbn0pXG5cbmFwcC51c2UoKGVyciwgcmVxLCByZXMsIG5leHQpID0+IHtcbiAgY29uc29sZS5sb2coJ2VycicsIGVyci5zdGF0dXNDb2RlIHx8IGVycilcbiAgcmVzLnN0YXR1cyhlcnIuc3RhdHVzQ29kZSB8fCBlcnIpLnNlbmQoKTtcbn0pXG5cbmFwcC5saXN0ZW4ocHJvY2Vzcy5lbnYuUE9SVCB8fCA5MDAwKVxuXG5cbm1vZHVsZS5leHBvcnRzID0gYXBwO1xuIl19