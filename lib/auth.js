'use strict';

var request = require('request-promise');
var _ = require('lodash');
var Promise = require('bluebird');

var clientId = process.env['SPOTIFY_ID'];
var clientSecret = process.env['SPOTIFY_SECRET'];

var authString = new Buffer(clientId + ':' + clientSecret).toString('base64');

function getToken() {
  return request({
    url: 'https://accounts.spotify.com/api/token',
    method: 'POST',
    headers: {
      Authorization: 'Basic ' + authString
    },
    form: {
      grant_type: 'client_credentials'
    } }).then(function (res) {
    return JSON.parse(res).access_token;
  });
}

var callSpotify = function callSpotify(url, token) {
  if (_.isString(url)) {
    url = { url: url };
  }
  return request(_.merge({
    headers: {
      Authorization: 'Bearer ' + token
    },
    json: true
  }, url));
};

module.exports = {
  callSpotify: callSpotify,
  getToken: getToken
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9hdXRoLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsSUFBSSxVQUFVLFFBQVEsaUJBQVIsQ0FBZDtBQUNBLElBQUksSUFBSSxRQUFRLFFBQVIsQ0FBUjtBQUNBLElBQUksVUFBVSxRQUFRLFVBQVIsQ0FBZDs7QUFFQSxJQUFJLFdBQVcsUUFBUSxHQUFSLENBQVksWUFBWixDQUFmO0FBQ0EsSUFBSSxlQUFlLFFBQVEsR0FBUixDQUFZLGdCQUFaLENBQW5COztBQUVBLElBQUksYUFBYSxJQUFJLE1BQUosQ0FBVyxXQUFXLEdBQVgsR0FBaUIsWUFBNUIsRUFBMEMsUUFBMUMsQ0FBbUQsUUFBbkQsQ0FBakI7O0FBRUEsU0FBUyxRQUFULEdBQXFCO0FBQ25CLFNBQU8sUUFBUTtBQUNiLFNBQUssd0NBRFE7QUFFYixZQUFRLE1BRks7QUFHYixhQUFTO0FBQ1AscUJBQWUsV0FBVztBQURuQixLQUhJO0FBTWIsVUFBTTtBQUNKLGtCQUFZO0FBRFIsS0FOTyxFQUFSLEVBU0osSUFUSSxDQVNDO0FBQUEsV0FBTyxLQUFLLEtBQUwsQ0FBVyxHQUFYLEVBQWdCLFlBQXZCO0FBQUEsR0FURCxDQUFQO0FBVUQ7O0FBRUQsSUFBSSxjQUFjLFNBQWQsV0FBYyxDQUFVLEdBQVYsRUFBZSxLQUFmLEVBQXNCO0FBQ3RDLE1BQUksRUFBRSxRQUFGLENBQVcsR0FBWCxDQUFKLEVBQXFCO0FBQ25CLFVBQU0sRUFBRSxLQUFLLEdBQVAsRUFBTjtBQUNEO0FBQ0QsU0FBTyxRQUFRLEVBQUUsS0FBRixDQUFRO0FBQ3JCLGFBQVM7QUFDUCxxQkFBZSxZQUFZO0FBRHBCLEtBRFk7QUFJckIsVUFBTTtBQUplLEdBQVIsRUFLWixHQUxZLENBQVIsQ0FBUDtBQU1ELENBVkQ7O0FBWUEsT0FBTyxPQUFQLEdBQWlCO0FBQ2YsZUFBYSxXQURFO0FBRWYsWUFBVTtBQUZLLENBQWpCIiwiZmlsZSI6ImF1dGguanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgcmVxdWVzdCA9IHJlcXVpcmUoJ3JlcXVlc3QtcHJvbWlzZScpO1xudmFyIF8gPSByZXF1aXJlKCdsb2Rhc2gnKTtcbnZhciBQcm9taXNlID0gcmVxdWlyZSgnYmx1ZWJpcmQnKTtcblxudmFyIGNsaWVudElkID0gcHJvY2Vzcy5lbnZbJ1NQT1RJRllfSUQnXTtcbnZhciBjbGllbnRTZWNyZXQgPSBwcm9jZXNzLmVudlsnU1BPVElGWV9TRUNSRVQnXTtcblxudmFyIGF1dGhTdHJpbmcgPSBuZXcgQnVmZmVyKGNsaWVudElkICsgJzonICsgY2xpZW50U2VjcmV0KS50b1N0cmluZygnYmFzZTY0Jyk7XG5cbmZ1bmN0aW9uIGdldFRva2VuICgpIHtcbiAgcmV0dXJuIHJlcXVlc3Qoe1xuICAgIHVybDogJ2h0dHBzOi8vYWNjb3VudHMuc3BvdGlmeS5jb20vYXBpL3Rva2VuJyxcbiAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICBoZWFkZXJzOiB7XG4gICAgICBBdXRob3JpemF0aW9uOiAnQmFzaWMgJyArIGF1dGhTdHJpbmdcbiAgICB9LFxuICAgIGZvcm06IHtcbiAgICAgIGdyYW50X3R5cGU6ICdjbGllbnRfY3JlZGVudGlhbHMnXG4gICAgfX0pXG4gICAgLnRoZW4ocmVzID0+IEpTT04ucGFyc2UocmVzKS5hY2Nlc3NfdG9rZW4pXG59XG5cbnZhciBjYWxsU3BvdGlmeSA9IGZ1bmN0aW9uICh1cmwsIHRva2VuKSB7XG4gIGlmIChfLmlzU3RyaW5nKHVybCkpIHtcbiAgICB1cmwgPSB7IHVybDogdXJsIH07XG4gIH1cbiAgcmV0dXJuIHJlcXVlc3QoXy5tZXJnZSh7XG4gICAgaGVhZGVyczoge1xuICAgICAgQXV0aG9yaXphdGlvbjogJ0JlYXJlciAnICsgdG9rZW5cbiAgICB9LFxuICAgIGpzb246IHRydWVcbiAgfSwgdXJsKSlcbn1cblxubW9kdWxlLmV4cG9ydHMgPSB7XG4gIGNhbGxTcG90aWZ5OiBjYWxsU3BvdGlmeSxcbiAgZ2V0VG9rZW46IGdldFRva2VuXG59XG4iXX0=