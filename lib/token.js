'use strict';

// token middleware to stamp user onto Spotify token
var request = require('request-promise');

function getBearerToken(req) {
  if (req.headers.authorization && req.headers.authorization.split(' ')[0] === 'Bearer') {
    return req.headers.authorization.split(' ')[1];
  }
  return null;
}

function createSpotifyMiddleware() {
  return function spotifyMiddleware(req, res, next) {
    var token = getBearerToken(req);
    request({
      url: 'https://api.spotify.com/v1/me',
      headers: {
        Authorization: 'Bearer ' + token
      },
      json: true
    }).then(function (user) {
      req.user = user;
      next();
    }).catch(next);
  };
}

module.exports = createSpotifyMiddleware;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy90b2tlbi5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFDQSxJQUFJLFVBQVUsUUFBUSxpQkFBUixDQUFkOztBQUVBLFNBQVMsY0FBVCxDQUF5QixHQUF6QixFQUE4QjtBQUM1QixNQUFJLElBQUksT0FBSixDQUFZLGFBQVosSUFBNkIsSUFBSSxPQUFKLENBQVksYUFBWixDQUEwQixLQUExQixDQUFnQyxHQUFoQyxFQUFxQyxDQUFyQyxNQUE0QyxRQUE3RSxFQUF1RjtBQUNyRixXQUFPLElBQUksT0FBSixDQUFZLGFBQVosQ0FBMEIsS0FBMUIsQ0FBZ0MsR0FBaEMsRUFBcUMsQ0FBckMsQ0FBUDtBQUNEO0FBQ0QsU0FBTyxJQUFQO0FBQ0Q7O0FBRUQsU0FBUyx1QkFBVCxHQUFvQztBQUNsQyxTQUFPLFNBQVMsaUJBQVQsQ0FBNEIsR0FBNUIsRUFBaUMsR0FBakMsRUFBc0MsSUFBdEMsRUFBNEM7QUFDakQsUUFBSSxRQUFRLGVBQWUsR0FBZixDQUFaO0FBQ0EsWUFBUTtBQUNOLFdBQUssK0JBREM7QUFFTixlQUFTO0FBQ1AsdUJBQWUsWUFBWTtBQURwQixPQUZIO0FBS04sWUFBTTtBQUxBLEtBQVIsRUFPRyxJQVBILENBT1EsZ0JBQVE7QUFDWixVQUFJLElBQUosR0FBVyxJQUFYO0FBQ0E7QUFDRCxLQVZILEVBV0csS0FYSCxDQVdTLElBWFQ7QUFZRCxHQWREO0FBZUQ7O0FBRUQsT0FBTyxPQUFQLEdBQWlCLHVCQUFqQiIsImZpbGUiOiJ0b2tlbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vIHRva2VuIG1pZGRsZXdhcmUgdG8gc3RhbXAgdXNlciBvbnRvIFNwb3RpZnkgdG9rZW5cbnZhciByZXF1ZXN0ID0gcmVxdWlyZSgncmVxdWVzdC1wcm9taXNlJyk7XG5cbmZ1bmN0aW9uIGdldEJlYXJlclRva2VuIChyZXEpIHtcbiAgaWYgKHJlcS5oZWFkZXJzLmF1dGhvcml6YXRpb24gJiYgcmVxLmhlYWRlcnMuYXV0aG9yaXphdGlvbi5zcGxpdCgnICcpWzBdID09PSAnQmVhcmVyJykge1xuICAgIHJldHVybiByZXEuaGVhZGVycy5hdXRob3JpemF0aW9uLnNwbGl0KCcgJylbMV07XG4gIH1cbiAgcmV0dXJuIG51bGw7XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZVNwb3RpZnlNaWRkbGV3YXJlICgpIHtcbiAgcmV0dXJuIGZ1bmN0aW9uIHNwb3RpZnlNaWRkbGV3YXJlIChyZXEsIHJlcywgbmV4dCkge1xuICAgIHZhciB0b2tlbiA9IGdldEJlYXJlclRva2VuKHJlcSk7XG4gICAgcmVxdWVzdCh7XG4gICAgICB1cmw6ICdodHRwczovL2FwaS5zcG90aWZ5LmNvbS92MS9tZScsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgIEF1dGhvcml6YXRpb246ICdCZWFyZXIgJyArIHRva2VuXG4gICAgICB9LFxuICAgICAganNvbjogdHJ1ZVxuICAgIH0pXG4gICAgICAudGhlbih1c2VyID0+IHtcbiAgICAgICAgcmVxLnVzZXIgPSB1c2VyO1xuICAgICAgICBuZXh0KCk7XG4gICAgICB9KVxuICAgICAgLmNhdGNoKG5leHQpXG4gIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBjcmVhdGVTcG90aWZ5TWlkZGxld2FyZTtcbiJdfQ==